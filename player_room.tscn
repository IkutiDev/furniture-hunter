[gd_scene load_steps=29 format=3 uid="uid://clgfkcao6rjbb"]

[ext_resource type="Script" uid="uid://bb5uux4xnry1f" path="res://player_room.gd" id="1_1ojmq"]
[ext_resource type="MeshLibrary" uid="uid://byu67pqu2ls5g" path="res://mesh_libraries/floor_mesh_library.tres" id="1_8tnse"]
[ext_resource type="PackedScene" uid="uid://5eeyn2nbl4it" path="res://UI/inventory_ui.tscn" id="2_2dulj"]
[ext_resource type="MeshLibrary" uid="uid://d2uj2lhtrmjgf" path="res://mesh_libraries/walls_mesh_library.tres" id="2_plsfm"]
[ext_resource type="MeshLibrary" uid="uid://n8md08bf2oeb" path="res://mesh_libraries/occupation_mesh_library.tres" id="4_3q6a7"]
[ext_resource type="Script" uid="uid://bx5l051p6ecdf" path="res://object_placer.gd" id="5_3q6a7"]
[ext_resource type="Script" uid="uid://bd046eokvcnu2" path="res://addons/phantom_camera/scripts/phantom_camera_host/phantom_camera_host.gd" id="5_358ef"]
[ext_resource type="Script" uid="uid://brjslag6tqsvp" path="res://UI/main_ui.gd" id="6_d0s76"]
[ext_resource type="PackedScene" uid="uid://b8myxwy4rg0ac" path="res://UI/auction_ui.tscn" id="7_2dulj"]
[ext_resource type="PackedScene" uid="uid://bh0yjjoyposcl" path="res://UI/set_furniture_price_ui.tscn" id="8_o6f6g"]
[ext_resource type="PackedScene" uid="uid://dh7xwd15ho7lk" path="res://non_persons/spawner.tscn" id="9_8qgar"]
[ext_resource type="Texture2D" uid="uid://rts31v4bln5h" path="res://UI/WIP_icons/wrecking-ball.png" id="10_8qgar"]
[ext_resource type="PackedScene" uid="uid://teevnykaumjf" path="res://UI/set_item_price_ui.tscn" id="12_1t0pb"]
[ext_resource type="Script" uid="uid://8umksf8e80fw" path="res://addons/phantom_camera/scripts/resources/tween_resource.gd" id="13_358ef"]
[ext_resource type="Script" uid="uid://csjccrhj5wnx7" path="res://addons/phantom_camera/scripts/phantom_camera/phantom_camera_3d.gd" id="14_4pcic"]
[ext_resource type="Script" uid="uid://c8ndgo8lrx3b4" path="res://camera_controller.gd" id="15_pq8mr"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_1ojmq"]
sky_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)
ground_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)

[sub_resource type="Sky" id="Sky_3q6a7"]
sky_material = SubResource("ProceduralSkyMaterial_1ojmq")

[sub_resource type="Environment" id="Environment_wo40j"]
background_mode = 1
background_color = Color(0.35285613, 0.48420393, 0.7247728, 1)
sky = SubResource("Sky_3q6a7")
tonemap_mode = 2

[sub_resource type="NavigationMesh" id="NavigationMesh_wo40j"]
vertices = PackedVector3Array(5.75, 0.57, 4, 10.75, 0.57, 3.75, 10.75, 0.57, 3.25, 5.75, 0.57, 3, -6.75, 0.57, -1.75, -6.75, 0.57, 1.75, -2.75, 0.57, 2, -2.75, 0.57, 3, -3.75, 0.57, 3.25, -3.75, 0.57, 8.75, 5.75, 0.57, -1.75, 5.75, 0.57, 8.75)
polygons = [PackedInt32Array(2, 1, 0), PackedInt32Array(3, 2, 0), PackedInt32Array(6, 5, 4), PackedInt32Array(9, 8, 7), PackedInt32Array(6, 4, 10), PackedInt32Array(6, 10, 3), PackedInt32Array(7, 6, 3), PackedInt32Array(7, 3, 0), PackedInt32Array(11, 9, 7), PackedInt32Array(0, 11, 7)]
geometry_parsed_geometry_type = 1
cell_height = 0.01
agent_radius = 0.2
region_min_size = 1.0
vertices_per_polygon = 3.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2dulj"]
transparency = 1
albedo_color = Color(0.23339033, 0.4372358, 0.23134169, 0.85882354)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_wo40j"]
transparency = 1
albedo_color = Color(0.72300655, 0.022634376, 2.5894344e-05, 0.85882354)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_1t0pb"]
bg_color = Color(0.61574835, 0.12566853, 0.2409707, 1)

[sub_resource type="Theme" id="Theme_358ef"]
Button/styles/normal = SubResource("StyleBoxFlat_1t0pb")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_3gq20"]
bg_color = Color(0.16916928, 0.40496358, 0.21367723, 1)

[sub_resource type="Theme" id="Theme_1t0pb"]
Button/styles/normal = SubResource("StyleBoxFlat_3gq20")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_d0s76"]
bg_color = Color(0, 0.42836863, 0, 0.6)

[sub_resource type="Resource" id="Resource_1l8t1"]
script = ExtResource("13_358ef")

[node name="PlayerRoom" type="Node3D" node_paths=PackedStringArray("floor_grid_map", "occupation_grid_map")]
script = ExtResource("1_1ojmq")
floor_grid_map = NodePath("NavigationRegion3D/FloorMap")
occupation_grid_map = NodePath("OccupationMap")

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_wo40j")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.8660254, -0.43301278, 0.25, 0, 0.49999997, 0.86602545, -0.50000006, 0.75, -0.43301266, 0, 0, 0)
shadow_enabled = true

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.023526192, -0.011831045, -0.0057860613)
navigation_mesh = SubResource("NavigationMesh_wo40j")

[node name="FloorMap" type="GridMap" parent="NavigationRegion3D"]
mesh_library = ExtResource("1_8tnse")
cell_size = Vector3(1, 1, 1)
cell_center_x = false
cell_center_z = false
data = {
"cells": PackedInt32Array(65533, 8, 0, 65533, 7, 0, 65533, 6, 0, 65533, 5, 0, 65533, 4, 0, 65533, 3, 0, 65534, 3, 0, 65534, 4, 0, 65534, 5, 0, 65534, 6, 0, 65534, 7, 0, 65534, 8, 0, 65535, 8, 0, 65535, 7, 0, 65535, 6, 0, 65535, 5, 0, 65535, 4, 0, 65535, 3, 0, 65535, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 1, 8, 0, 2, 8, 0, 2, 7, 0, 1, 7, 0, 3, 7, 0, 4, 7, 0, 4, 8, 0, 3, 8, 0, 5, 8, 0, 5, 7, 0, 5, 6, 0, 4, 6, 0, 3, 6, 0, 2, 6, 0, 1, 6, 0, 1, 5, 0, 2, 5, 0, 3, 5, 0, 4, 5, 0, 5, 5, 0, 5, 4, 0, 4, 4, 0, 3, 4, 0, 2, 4, 0, 1, 4, 0, 1, 3, 0, 2, 3, 0, 3, 3, 0, 4, 3, 0, 5, 3, 0, 5, 2, 0, 5, 1, 0, 5, 0, 0, 5, 65535, 0, 4, 65535, 0, 4, 65534, 0, 5, 65534, 0, 4, 0, 0, 4, 1, 0, 4, 2, 0, 3, 1, 0, 3, 0, 0, 3, 2, 0, 3, 65535, 0, 3, 65534, 0, 2, 65534, 0, 2, 65535, 0, 2, 0, 0, 2, 1, 0, 2, 2, 0, 1, 1, 0, 1, 0, 0, 1, 65535, 0, 1, 2, 0, 0, 2, 0, 65534, 2, 0, 65534, 1, 0, 65535, 1, 0, 0, 1, 0, 0, 0, 0, 65535, 0, 0, 65533, 1, 0, 65532, 1, 0, 65531, 1, 0, 65530, 1, 0, 65530, 0, 0, 65530, 65535, 0, 65530, 65534, 0, 65531, 65534, 0, 65532, 65534, 0, 65533, 65534, 0, 65534, 65534, 0, 65535, 65534, 0, 0, 65534, 0, 1, 65534, 0, 0, 65535, 0, 65535, 65535, 0, 65534, 65535, 0, 65533, 65535, 0, 65532, 65535, 0, 65531, 65535, 0, 65531, 0, 0, 65532, 0, 0, 65533, 0, 0, 65534, 0, 0, 6, 3, 0, 7, 3, 0, 8, 3, 0, 9, 3, 0, 10, 3, 0)
}

[node name="WallsMap" type="GridMap" parent="."]
mesh_library = ExtResource("2_plsfm")
cell_size = Vector3(1, 1, 1)
cell_center_x = false
cell_center_z = false
data = {
"cells": PackedInt32Array(6, 4, 1441792, 6, 2, 1441792, 6, 1, 1441792, 6, 0, 1441792, 6, 65535, 1441792, 6, 65534, 1441792, 6, 5, 1441792, 6, 6, 1441792, 6, 7, 1441792, 6, 8, 1441792, 6, 9, 655360, 5, 9, 655360, 4, 9, 655360, 3, 9, 655360, 2, 9, 655360, 1, 9, 655360, 0, 9, 655360, 65535, 9, 655360, 65534, 9, 655360, 65533, 9, 1048576, 65533, 8, 1048576, 65533, 7, 1048576, 65533, 6, 1048576, 65533, 5, 1048576, 65533, 4, 1048576, 65533, 3, 0, 65534, 2, 655360, 65534, 3, 1048577, 65533, 2, 655360, 65532, 2, 655360, 65531, 2, 655360, 65530, 2, 1048576, 65530, 1, 1048576, 65530, 0, 1048576, 65530, 65535, 1048576, 65530, 65534, 0, 65531, 65534, 0, 65532, 65534, 0, 65533, 65534, 0, 5, 65534, 0, 4, 65534, 0, 3, 65534, 0, 2, 65534, 0, 1, 65534, 0, 0, 65534, 0, 65535, 65534, 0, 65534, 65534, 0)
}

[node name="OccupationMap" type="GridMap" parent="."]
visible = false
mesh_library = ExtResource("4_3q6a7")
cell_size = Vector3(1, 1, 1)
collision_mask = 0

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(0.86427045, -0.40119925, 0.30342412, 0, 0.603206, 0.79757994, -0.50301737, -0.6893294, 0.5213348, 4.955, 7.685, 7.253605)

[node name="PhantomCameraHost" type="Node" parent="Camera3D"]
process_priority = 300
process_physics_priority = 300
script = ExtResource("5_358ef")
metadata/_custom_type_script = "uid://bd046eokvcnu2"

[node name="ObjectPlacer" type="Node" parent="." node_paths=PackedStringArray("occupation_grid_map", "visual_mesh_parent", "visual_mesh", "nav_mesh_region")]
script = ExtResource("5_3q6a7")
occupation_grid_map = NodePath("../OccupationMap")
visual_mesh_parent = NodePath("Node3D")
visual_mesh = NodePath("Node3D/SelectedFurnitureMesh")
can_place_material = SubResource("StandardMaterial3D_2dulj")
cant_place_material = SubResource("StandardMaterial3D_wo40j")
nav_mesh_region = NodePath("../NavigationRegion3D")

[node name="Node3D" type="Node3D" parent="ObjectPlacer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.5, 0, -0.5)

[node name="SelectedFurnitureMesh" type="MeshInstance3D" parent="ObjectPlacer/Node3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.125, 0, 0.125)
skeleton = NodePath("../..")

[node name="MainUI" type="Control" parent="." node_paths=PackedStringArray("remove_furnitue_button", "change_shop_state_button", "hour_label")]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = ExtResource("6_d0s76")
remove_furnitue_button = NodePath("RemoveFurnitureButton")
change_shop_state_button = NodePath("ChangeShopStateButton")
button_color_during_day = SubResource("Theme_358ef")
button_text_during_day = "Close Shop"
button_color_during_night = SubResource("Theme_1t0pb")
button_text_during_night = "Open Shop"
hour_label = NodePath("ChangeShopStateButton/Label")

[node name="RemoveFurnitureButton" type="TextureButton" parent="MainUI"]
layout_mode = 0
offset_right = 90.0
offset_bottom = 90.0
texture_normal = ExtResource("10_8qgar")
ignore_texture_size = true
stretch_mode = 4

[node name="ChangeShopStateButton" type="Button" parent="MainUI"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -42.0
offset_right = 43.0
offset_bottom = 23.0
grow_horizontal = 2
theme_override_constants/align_to_largest_stylebox = 285
theme_override_styles/normal = SubResource("StyleBoxFlat_d0s76")
text = "Open Shop"

[node name="Label" type="Label" parent="MainUI/ChangeShopStateButton"]
layout_mode = 1
anchors_preset = 6
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = 4.0
offset_top = -11.5
offset_right = 65.0
offset_bottom = 11.5
grow_horizontal = 0
grow_vertical = 2
text = "8:00"

[node name="InventoryUI" parent="." instance=ExtResource("2_2dulj")]

[node name="AuctionUI" parent="." instance=ExtResource("7_2dulj")]

[node name="Spawner" parent="." node_paths=PackedStringArray("where_to_plonk_customers") instance=ExtResource("9_8qgar")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 11.060858, 0, 3.5197692)
where_to_plonk_customers = NodePath("../NavigationRegion3D")
max_customer_count = 1

[node name="SpawnPoint" parent="Spawner" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.410407, 0.54527146, -0.07077289)

[node name="TheAreaThatEatsPeople" parent="Spawner" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.5956945, 0.62753797, 0)

[node name="ShopEntrance" parent="Spawner" index="3"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.8547406, 0, -0.5226226)

[node name="DayToggle" parent="Spawner" index="4"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.4850283, 1.72174, 0)

[node name="ContexSpecificUI" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="SetFurniturePriceUI" parent="ContexSpecificUI" instance=ExtResource("8_o6f6g")]
visible = false
layout_mode = 1

[node name="SetItemPriceUI" parent="ContexSpecificUI" instance=ExtResource("12_1t0pb")]
visible = false
layout_mode = 1

[node name="PhantomCamera3D" type="Node3D" parent="." node_paths=PackedStringArray("follow_target")]
transform = Transform3D(0.86427045, -0.40119925, 0.30342412, 0, 0.603206, 0.79757994, -0.50301737, -0.6893294, 0.5213348, 4.955, 7.685, 7.253605)
top_level = true
script = ExtResource("14_4pcic")
follow_mode = 2
follow_target = NodePath("../CameraController")
tween_resource = SubResource("Resource_1l8t1")
follow_offset = Vector3(4.955, 7.685, 4.7)
follow_damping = true
metadata/_custom_type_script = "uid://csjccrhj5wnx7"

[node name="CameraController" type="Node3D" parent="."]
transform = Transform3D(-0.7071067, 0, 0.7071067, 0, 1, 0, -0.7071067, 0, -0.7071067, 0, 0, 2.553605)
script = ExtResource("15_pq8mr")
limit_x = Vector2(5, -5)
limit_z = Vector2(5, -5)
speed = 10.0

[editable path="Spawner"]
